<database defaultIdMethod="native" package="actors.classes" name="application" >

	<table name="actors_actor" phpName="Actor" description="Base de Actores">

		<column name="id" description="Identificacion del actor" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
		<column name="title" description="Titulo" type="CHAR" size="15" />
		<column name="name" description="Nombre" type="CHAR" size="90" />
		<column name="surname" description="Apellido" type="CHAR" size="90" />
		<column name="nickname" description="Sobrenombre" type="CHAR" size="90" />
		<column name="institution" description="Institucion" type="CHAR" size="200" />

		<behavior name="soft_delete" />

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Categorias de actores -->
	<table name="actors_category" phpName="ActorCategory" description="Categorias de Actores">

		<column name="id" required="true" primaryKey="true" type="INTEGER" autoIncrement="true" description="Category Id" />
		<column name="name" required="true" type="VARCHAR" size="100" description="Category Name" />

		<behavior name="nested_set">
			<parameter name="use_scope" value="true" />
			<parameter name="scope_column" value="scope" />
		</behavior>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Relacion many-to-many de Actores y Categorias de actores -->
	<table name="actors_actorsCategory" phpName="ActorCategoryRelation" isCrossRef="true" description="Relacion Actores y Categorias">

		<column name="actorId" required="true" primaryKey="true" type="INTEGER" size="5" description="Actor Id"/>
		<column name="categoryId" required="true" primaryKey="true" type="INTEGER" size="5" description="Category Id"/>

		<foreign-key foreignTable="actors_actor" onDelete="CASCADE">
			<reference local="actorId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="actors_category" onDelete="CASCADE">
			<reference local="categoryId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- MER -->

	<!-- Formularios de perfil de actores -->
	<table name="actors_profileForm" phpName="ProfileForm" description="Base de Formularios de Perfiles">

		<column name="id" description="Identificacion del formulario de perfil" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
		<column name="name" description="Nombre" type="CHAR" size="90" />
		<column name="relationship" type="BOOLEAN" sqlType="BOOL" required="true" default="0" description="Is this form a relationship form?" />
		<column name="type" required="true" type="INTEGER" size="2" description="Tipo de elemento "/>
		<column name="question" type="VARCHAR" size="255" description="Texto de la pregunta" />
		<column name="questionType" type="SMALLINT" required="true" description="Tipo de pregunta" />
		<column name="label"  type="VARCHAR" size="80" description="Label de la pregunta" />
		<column name="inAnalysis" default="false" type="BOOLEAN" sqlType="BOOL" description="Aparece la pregunta en analysis?"/>

		<behavior name="nested_set">
			<parameter name="use_scope" value="true" />
			<parameter name="scope_column" value="scope" />
		</behavior>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Opciones de preguntas de seleccion -->
	<table name="actors_profileFormQuestionOption" phpName="QuestionOption" description="Options for select questions" >

		<column name="id" description="Identificacion de la opcion" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
		<column name="formId"  type="INTEGER" required="true" description="Identificacion de la pregunta" />
		<column name="order" type="INTEGER" required="true" description="" primaryKey="true" />
		<column name="value" type="VARCHAR" size="255" required="true" description="" />
		<column name="text" type="VARCHAR" size="255" required="true" description="" />
		<column name="defaultOpc" type="BOOLEAN" sqlType="BOOL" description="" />

		<foreign-key foreignTable="actors_profileForm" onDelete="CASCADE">
			<reference local="formId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Relaciones many-to-many de relacion entre actores -->
	<table name="actors_relations" phpName="ActorRelation" description="Tabla de relaciones de actores" >

		<column name="actorFromId" type="INTEGER" required="true" description="Identificacion Actor origen" primaryKey="true" />
		<column name="actorToId" type="INTEGER" required="true" description="Identificacion Actor destino" primaryKey="true" />
		<column name="questionId" type="INTEGER" required="true" description="Pregunta" primaryKey="true" />
		<column name="direction"  type="BOOLEAN" sqlType="BOOL" required="true" description="Direccion de la relacion" />
		<column name="current"  type="VARCHAR" size="255" required="true" description="Current relationship" />
		<column name="potential"  type="VARCHAR" size="255" required="true" description="Potential relationship" />


		<foreign-key foreignTable="actors_actor" onDelete="CASCADE">
			<reference local="actorFromId" foreign="id" />
			<reference local="actorToId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="actors_profileForm" onDelete="CASCADE">
			<reference local="questionId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Preguntas activas para cada actor -->
	<table name="actors_activeQuestions" phpName="ActorActiveQuestion" description="Tabla de preguntas activas" >

		<column name="actorId"  type="INTEGER" required="true" description="" primaryKey="true" />
		<column name="questionId"  type="INTEGER" required="true" description="" primaryKey="true" />

		<foreign-key foreignTable="actors_actor" onDelete="CASCADE">
			<reference local="actorId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="actors_profileForm" onDelete="CASCADE">
			<reference local="questionId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Preguntas activas para cada relacion de par de actores -->
	<table name="actors_activeRelationQuestions" phpName="ActorActiveRelationQuestion" isCrossRef="true" description="Tabla de preguntas activas de relacion" >

		<column name="actorFromId"  type="INTEGER" required="true" description="" primaryKey="true" />
		<column name="actorToId"  type="INTEGER" required="true" description="" primaryKey="true" />
		<column name="questionId"  type="INTEGER" required="true" description="" primaryKey="true" />

		<foreign-key foreignTable="actors_actor" onDelete="CASCADE">
			<reference local="actorFromId" foreign="id" />
			<reference local="actorToId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="actors_profileForm" onDelete="CASCADE">
			<reference local="questionId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<!-- Respuestas a las preguntas -->
	<table name="actors_formAnswer" phpName="ActorFormAnswer" description="Tabla de respuestas" >

		<column name="id" description="Identificacion de la respuesta" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
		<column name="actorId" type="INTEGER" required="true" description="" />
		<column name="questionId" type="INTEGER" required="true" description="" />
		<column name="answer" type="VARCHAR" size="255" required="true" description="" />
		<column name="judgement" type="VARCHAR" size="255" description="Juicio" />
		<column name="current" type="INTEGER" description="Indica si el juicio esta vigente o no" />
		<column name="updated" type="TIMESTAMP" description="Ultima actualizacion" />

		<foreign-key foreignTable="actors_actor" onDelete="CASCADE">
			<reference local="actorId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="actors_profileForm" onDelete="CASCADE">
			<reference local="questionId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

</database>


