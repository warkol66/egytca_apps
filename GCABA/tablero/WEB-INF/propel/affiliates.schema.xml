<database defaultIdMethod="native" package="affiliates.classes" name="application" >

	<table name="affiliates_affiliate" phpName="Affiliate"  description="Afiliados">

		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Id afiliado" autoIncrement="true"/>
		<column name="name" required="true"  type="VARCHAR" size="255" description="nombre afiliado"/>
		<column name="ownerId" type="INTEGER" description="Id del usuario administrador del afiliado" />
		<column name="updated" type="TIMESTAMP" description="Ultimo cambio"/>
		<column name="oldId" type="INTEGER" description="Old Id"/>
		<column name="type" type="INTEGER" description="Typo"/>
		<column name="oldParentId" type="INTEGER" description="Antiguo padre Id"/>

		<behavior name="soft_delete" />

		<unique>
			<unique-column name="name" />
		</unique>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>

	<table name="affiliates_affiliateInfo" phpName="AffiliateInfo"  description="Informacion del afiliado">
		<column name="affiliateId" primaryKey="true" required="true" type="INTEGER" description="Id afiliado"/>
		<column name="name" type="VARCHAR" size="255" description="Direccion afiliado"/>
		<column name="affiliateInternalNumber" required="true" type="INTEGER" description="Id interno"/>
		<column name="address" type="VARCHAR" size="255" description="Direccion afiliado"/>
		<column name="phone" type="VARCHAR" size="50" description="Telefono afiliado"/>
		<column name="contact" type="VARCHAR" size="50" description="Nombre de persona de contacto"/>
		<column name="contactEmail" type="VARCHAR" size="100" description="Email de persona de contacto"/>
		<column name="web" type="VARCHAR" size="255" description="Direccion web del afiliado"/>
		<column name="memo" type="LONGVARCHAR" description="Informacion adicional del afiliado"/>
		<column name="holder" type="VARCHAR" size="255" description="Dependency Holder (titular)"/>
		<column name="directionBoardContact" type="VARCHAR"  size="255" description="Dependency Direction Board Contact (Contacto Direccion de Tablero)"/>
		<column name="telephone" type="VARCHAR" size="30"  description="Dependency Telephone"/>
		<column name="extraTelephone"   type="VARCHAR" size="30"  description="Dependency Extra Telephone"/>
		<column name="email" type="VARCHAR" size="255" description="Dependency Email" />
		<column name="responsible" type="VARCHAR" size="255" description="Dependency Responsible" />
		<column name="showInHome" type="BOOLEAN"  description="Se muestra en home"/>
		<column name="order" type="INTEGER" description="Order in home"/>
		<column name="imageIcon" type="VARCHAR" size="50" description="Icon name" />

		<behavior name="soft_delete" />

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

		<foreign-key foreignTable="affiliates_affiliate" >
			<reference local="affiliateId" foreign="id" />
		</foreign-key>

	</table>

	<table name="affiliates_user" phpName='AffiliateUser' description="Usuarios de afiliado">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="User Id" autoIncrement="true"/>
		<column name="affiliateId" required="true" type="INTEGER" description="Id afiliado"/>
		<column name="username" required="true"  type="VARCHAR" size="255" description="username"/>
		<column name="password" required="true"  type="VARCHAR" size="255" description="password"/>
		<column name="active" required="true"  type="BOOLEAN"  description="Is user active?"/>
		<column name="created" required="true"  type="TIMESTAMP"  description="Creation date for"/>
		<column name="updated" required="true"  type="TIMESTAMP"  description="Last update date"/>
		<column name="timezone" type="VARCHAR" size="100" description="Timezone GMT del usuario afiliado" />
		<column name="levelId" type="INTEGER" description="User Level" />
		<column name="lastLogin" type="TIMESTAMP" description="Fecha del ultimo login del usuario" />

		<behavior name="soft_delete" />

		<unique>
			<unique-column name="username" />
		</unique>

		<foreign-key foreignTable="affiliates_level" >
			<reference local="levelId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="affiliates_affiliate" >
			<reference local="affiliateId" foreign="id" />
		</foreign-key>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>

	<table name="affiliates_userInfo" phpName='AffiliateUserInfo' description="Information about users by affiliates">
		<column name="userId" required="true" primaryKey="true" type="INTEGER" description="User Id" />
		<column name="name" type="VARCHAR" size="255" description="name"/>
		<column name="surname" type="VARCHAR" size="255" description="surname"/>
		<column name="mailAddress" type="VARCHAR" size="255" description="Email" />

		<behavior name="soft_delete" />

		<foreign-key foreignTable="affiliates_user" >
			<reference local="userId" foreign="id" />
		</foreign-key>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>

	<table name="affiliates_level" phpName='AffiliateLevel' description="Levels">
		<column name="id" required="true"  primaryKey='true' type="INTEGER"  description="Level ID" autoIncrement="true"/>
		<column name="name" required="true"  type="VARCHAR" size="255"  description="Level Name"/>
		<column name="bitLevel" type="INTEGER"  description="Bit del nivel"/>

		<behavior name="soft_delete" />

		<unique>
			<unique-column name="name" />
		</unique>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>

	<table name="affiliates_userGroup" phpName='AffiliateUserGroup' description="Users / Groups">
		<column name="userId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
		<column name="groupId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>

		<foreign-key foreignTable="affiliates_user">
			<reference local="userId" foreign="id"/>
		</foreign-key>

		<foreign-key foreignTable="affiliates_group" onDelete="cascade">
			<reference local="groupId" foreign="id"/>
		</foreign-key>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>

	<table name="affiliates_group" phpName='AffiliateGroup' description="Groups">
		<column name="id" required="true"  primaryKey='true' type="INTEGER"  description="Group ID" autoIncrement="true"/>
		<column name="name" required="true"  type="VARCHAR" size="255"  description="Group Name"/>
		<column name="created" required="true"  type="TIMESTAMP"  description="Creation date for"/>
		<column name="updated" required="true"  type="TIMESTAMP"  description="Last update date"/>
		<column name="bitLevel"   type="INTEGER"  description="Nivel"/>

		<behavior name="soft_delete" />

		<unique>
			<unique-column name="name" />
		</unique>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>
	
	<table name="affiliates_groupCategory" phpName="AffiliateGroupCategory" description="Groups_Categories" isCrossRef="true">

		<column name="groupId" required="true" primaryKey="true" type="INTEGER" description="Group ID"/>
		<column name="categoryId" required="true" primaryKey="true" type="INTEGER" description="Category ID"/>

		<foreign-key foreignTable="affiliates_group" onDelete="CASCADE" >
			<reference local="groupId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="categories_category" onDelete="CASCADE" >
			<reference local="categoryId" foreign="id" />
		</foreign-key>

		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>

	</table>

	<table name="affiliates_branch" phpName='AffiliateBranch' description="Affiliates branches information">
		<column name="id" autoIncrement="true" type="INTEGER" required="true" description="Id de la sucursal" primaryKey='true' />
		<column name="affiliateId" type="INTEGER"  required="true" description="Id del afiliado" />
		<column name="number" type="INTEGER"  required="true" description="Numero de la sucursal" />
		<column name="code" size="20" type="VARCHAR" description="Codigo de la sucursal" />
		<column name="name" size="255" type="VARCHAR" description="Nombre de la sucursal" />
		<column name="phone" size="100" type="VARCHAR" description="Telefono de la sucursal" />
		<column name="contact" type="VARCHAR" size="50" description="Nombre de persona de contacto"/>
		<column name="contactEmail" type="VARCHAR" size="100" description="Email de persona de contacto"/>
		<column name="memo" type="LONGVARCHAR" description="Informacion adicional de la sucursal"/>

		<behavior name="soft_delete" />

		<foreign-key foreignTable="affiliates_affiliate" >
			<reference local="affiliateId" foreign="id" />
		</foreign-key>

	  <vendor type="mysql">
	    <parameter name="Charset" value="utf8"/>
	    <parameter name="Collate" value="utf8_general_ci"/>
	  </vendor>

	</table>

</database>
