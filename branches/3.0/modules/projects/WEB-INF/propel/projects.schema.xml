<database defaultIdMethod="native" package="projects.classes" name="application" >
 	<!--Tablas de modulo proyectos-->

	<table name="projects_project" phpName='Project' description="Project">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Project Id" autoIncrement="true"/>
		<column name="objectiveId" required="true" type="INTEGER" description="Objective Id"/>
		<column name="code" type="VARCHAR" size="50" description="Project Code"/>
		<column name="codeAux" type="VARCHAR" size="50" description="Project Code Auxiliary code"/>
		<column name="name" required="true" type="VARCHAR" size="255" description="Project Name"/>
		<column name="description" type="LONGVARCHAR" description="Project Description"/>
		<column name="impact"  type="LONGVARCHAR" description="Project Impact"/>
		<column name="uniqueGoal"  type="LONGVARCHAR" description="Project Unique Goal"/>
		<column name="goalExpirationDate" type="DATE"  description="Project Goal Expiration Date"/>
		<column name="date" type="TIMESTAMP"  description="Project Creation Date"/>
		<column name="budget" type="FLOAT" description="Project Budget (Presupuesto)" />
		<column name="exchangeRate" type="FLOAT" description="Exchange Rate" />
		<column name="visibility" type="INTEGER" description="Visibility"/>
		<column name="coordinateNeed"  type="LONGVARCHAR" description="Project Coordinate Need"/>
		<column name="frequency"  type="LONGVARCHAR" description="Project Frequency"/>
		<column name="finished" type="BOOLEAN"  description="is Project Finished?"/>
		<column name="notes" type="LONGVARCHAR"  description="Project Notes"/>
		<column name="postalCode" type="VARCHAR" size="8"  description="Project Postal Code"/>
		<column name="uniqueGoalNumeric" type="INTEGER" description="Project Unique Goal Numeric"/>
		<column name="goalProgress" type="INTEGER" description="Project Goal Progress"/>
		<column name="latitude" type="FLOAT" description="latitud del proyecto" />
		<column name="longitude" type="FLOAT" description="longitud del proyecto" />
		<column name="oldId" type="INTEGER" description="Old Id"/>
		<column name="regionId" type="INTEGER" description="Region Id"/>
		<column name="oldRegionId" type="INTEGER" description="Old Region Id"/>
		<column name="lastModification" type="TIMESTAMP"  description="Ultima modificacion Date"/>
		<column name="address" type="VARCHAR" size="255" description="Direccion del proyecto"/>
		<column name="priority" type="INTEGER" description="Prioridad Id"/>
		<column name="modifications" type="INTEGER" description="Cantidad de modificaciones"/>
		<column name="plannedStart" type="DATE"  description="Project planned start"/>
		<column name="plannedEnd" type="DATE"  description="Project planned End"/>
		<column name="realStart" type="DATE"  description="Project real start"/>
		<column name="realEnd" type="DATE"  description="Project real end"/>
		<column name="cancelled" type="BOOLEAN" description="is project cancelled?" />
		<column name="construction" type="BOOLEAN"  description="is a construction?"/>
		<column name="relevance" type="VARCHAR" size="255" description="Importancia"/>
		<column name="order" type="INTEGER" required="true" default="0" description="Orden"/>
		<column name="weight" type="DECIMAL" required="true" default="0" description="Peso"/>
		<column name="updated" type="TIMESTAMP"  description="Updated"/>
		<column name="responsibleCode" type="INTEGER" required="true" description="Codigo del responsable"/>
		<column name="indicatorId" type="INTEGER" description="Id del indicador del grafico de desembolsos" />

		<behavior name="timestampable" />
		
		<behavior name="change_countable" />
		
		<behavior name="soft_delete" />

		<foreign-key foreignTable="objectives_objective" >
			<reference local="objectiveId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="positions_position" >
			<reference local="responsibleCode" foreign="code" />
		</foreign-key>
		
		<foreign-key foreignTable="indicators_indicator" >
			<reference local="indicatorId" foreign="id" />
		</foreign-key>
		
		<validator column="name">
			<rule name="maxLength"  value="255"  message="El nombre no debe contener mas de ${value} caracteres" />
		</validator>

		<validator column="name">
			<rule name="required"  message="El nombre es obligatorio" />
		</validator>

		<validator column="responsibleCode">
			<rule name="required"  message="El responsable es obligatorio" />
		</validator>

		<validator column="objectiveId">
			<rule name="required"  message="El ##objectives,3,Objetivo## es obligatorio" />
		</validator>

	</table>

	<table name="projects_region" phpName='ProjectRegion' isCrossRef="true" description="Asociacion entre Barrios y Proyectos">
		<column name="regionId" required="true" primaryKey="true" type="INTEGER" />
		<column name="projectId" required="true" primaryKey="true" type="INTEGER" />

		<foreign-key foreignTable="regions_region" >
			<reference local="regionId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>

	</table>
	
	<table name="projects_milestone" phpName='ProjectMilestone' description="Milestone">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Milestone Id" autoIncrement="true"/>
		<column name="projectId" required="true" type="INTEGER" description="Project Id"/>
		<column name="name" required="true" type="LONGVARCHAR" description="Milestone Name"/>
		<column name="date" type="DATE"  description="Milestone Creation Date"/>
		<column name="expirationDate" type="DATE"  description="Milestone Expiration Date"/>
		<column name="completed" type="BOOLEAN"  description="is Milestone Completed?"/>
		<column name="notes" type="LONGVARCHAR"  description="Project Notes"/>

		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>
	
	</table>	


	<table name="projects_indicator" phpName='ProjectIndicator' description="Indicator">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Indicator Id" autoIncrement="true"/>
		<column name="projectId" required="true" type="INTEGER" description="Project Id"/>
		<column name="communeId" type="INTEGER" description="Project Id"/>
		<column name="regionId"  type="INTEGER" description="Project Id"/>		
		<column name="name" required="true" type="VARCHAR" size="100" description="Indicator Name"/>
		<column name="expirationDate" type="DATE"  description="Indicator Expiration Date"/>
		<column name="measureUnitId" type="INTEGER" description="Measure Unit"/>
		<column name="notes" type="LONGVARCHAR"  description="Project Notes"/>
		<column name="started" type="BOOLEAN"  description="is Indicator Started?"/>
		<column name="startDate" type="DATE"  description="Indicator Start Date"/>
		<column name="endDate" type="DATE"  description="Indicator End Date"/>
		<column name="actualProgress" type="INTEGER" description="Indicator Actual Progress" />
		
		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>
		
		<foreign-key foreignTable="regions_region" >
			<reference local="regionId" foreign="id" />
		</foreign-key>
<!--		
		<foreign-key foreignTable="tablero_measureUnit" >
			<reference local="measureUnitId" foreign="id" />
		</foreign-key>		
	-->
	</table>

	<table name="projects_activity" phpName='ProjectActivity' description="Activity">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Activity Id" autoIncrement="true"/>
		<column name="projectId" required="true" type="INTEGER" description="Project Id"/>
		<column name="name" required="true" type="LONGVARCHAR" description="Activity Name"/>
		<column name="description" type="LONGVARCHAR" description="Activity Description"/>
		<column name="date" type="DATE"  description="Activity Creation Date"/>
		<column name="expirationDate" type="DATE"  description="Activity Expiration Date"/>
		<column name="completed" type="BOOLEAN"  description="is Activity Completed?"/>
		<column name="updated" type="TIMESTAMP"  description="Updated"/>
		<column name="uniqueGoalNumeric" type="INTEGER" description="Project Unique Goal Numeric"/>
		<column name="goalProgress" type="INTEGER" description="Activity Goal Progress"/>
		<column name="notes" type="LONGVARCHAR"  description="Activity Notes"/>
		<column name="lastModification" type="TIMESTAMP"  description="Ultima modificacion Date"/>
		<column name="changes" type="INTEGER" description="Cantidad de modificaciones"/>
		<column name="plannedStart" type="DATE"  description="Activity planned start"/>
		<column name="plannedEnd" type="DATE"  description="Activity planned End"/>
		<column name="realStart" type="DATE"  description="Activity real start"/>
		<column name="realEnd" type="DATE"  description="Activity real end"/>
		<column name="cancelled" type="BOOLEAN" description="is activity cancelled?" />

		<behavior name="soft_delete" />

		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>
	
	</table>
	
	<!-- Relacion many-to-many de projects con documents -->	
	<table name="projects_document" phpName="ProjectDocument" isCrossRef="true">
  		<column name="project_id" type="INTEGER" primaryKey="true"/>
  		<column name="document_id" type="INTEGER" primaryKey="true"/>
  		<foreign-key foreignTable="projects_project" onDelete="CASCADE">
    		<reference local="project_id" foreign="id"/>
  		</foreign-key>
  		<foreign-key foreignTable="documents_document" onDelete="CASCADE">
    		<reference local="document_id" foreign="id"/>
  		</foreign-key>
	</table>
	
	<!-- Relacion many-to-many de projects con contractors -->	
	<table name="projects_contractor" phpName="ProjectContractor" isCrossRef="true">
		<column name="id" required="true" type="INTEGER" primaryKey="true" autoIncrement="true"/>
  		<column name="project_id" type="INTEGER" />
  		<column name="contractor_id" type="INTEGER" />
		<column name="type" required="true" type="INTEGER" />
  		<foreign-key foreignTable="projects_project" onDelete="CASCADE">
    		<reference local="project_id" foreign="id"/>
  		</foreign-key>
  		<foreign-key foreignTable="panel_contractor" onDelete="CASCADE">
    		<reference local="contractor_id" foreign="id"/>
  		</foreign-key>
		
		<unique>
	    	<unique-column name="project_id" />
	    	<unique-column name="contractor_id" />
	    	<unique-column name="type" />
	 	</unique>
		
		<vendor type="mysql">
			<parameter name="Charset" value="utf8"/>
			<parameter name="Collate" value="utf8_general_ci"/>
		</vendor>
	</table>

<!--
Seccion de tablas de log
-->

	<table name="projects_projectLog" phpName='ProjectLog' description="ProjectLog">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Project Log Id" autoIncrement="true"/>
		<column name="projectId" required="true" type="INTEGER" description="Project Id" />
		<column name="objectiveId" required="true" type="INTEGER" description="Objective Id"/>
		<column name="code" type="VARCHAR" size="50" description="Project Code"/>
		<column name="codeAux" type="VARCHAR" size="50" description="Project Code Auxiliary code"/>
		<column name="name" required="true" type="VARCHAR" size="255" description="Project Name"/>
		<column name="description" type="LONGVARCHAR" description="Project Description"/>
		<column name="impact"  type="LONGVARCHAR" description="Project Impact"/>
		<column name="uniqueGoal"  type="LONGVARCHAR" description="Project Unique Goal"/>
		<column name="goalExpirationDate" type="DATE"  description="Project Goal Expiration Date"/>
		<column name="date" type="TIMESTAMP"  description="Project Creation Date"/>
		<column name="budget" type="FLOAT" description="Project Budget (Presupuesto)" />
		<column name="exchangeRate" type="FLOAT" description="Exchange Rate" />
		<column name="visibility" type="INTEGER" description="Visibility"/>
		<column name="coordinateNeed"  type="LONGVARCHAR" description="Project Coordinate Need"/>
		<column name="frequency"  type="LONGVARCHAR" description="Project Frequency"/>
		<column name="finished" type="BOOLEAN"  description="is Project Finished?"/>
		<column name="notes" type="LONGVARCHAR"  description="Project Notes"/>
		<column name="postalCode" type="VARCHAR" size="8"  description="Project Postal Code"/>
		<column name="uniqueGoalNumeric" type="INTEGER" description="Project Unique Goal Numeric"/>
		<column name="goalProgress" type="INTEGER" description="Project Goal Progress"/>
		<column name="latitude" type="FLOAT" description="latitud del proyecto" />
		<column name="longitude" type="FLOAT" description="longitud del proyecto" />
		<column name="oldId" type="INTEGER" description="Old Id"/>
		<column name="regionId" type="INTEGER" description="Region Id"/>
		<column name="oldRegionId" type="INTEGER" description="Old Region Id"/>
		<column name="lastModification" type="TIMESTAMP"  description="Ultima modificacion Date"/>
		<column name="address" type="VARCHAR" size="255" description="Direccion del proyecto"/>
		<column name="priority" type="INTEGER" description="Prioridad Id"/>
		<column name="modifications" type="INTEGER" description="Cantidad de modificaciones"/>
		<column name="changes" type="INTEGER" description="Cantidad de modificaciones"/>
		<column name="plannedStart" type="DATE"  description="Project planned start"/>
		<column name="plannedEnd" type="DATE"  description="Project planned End"/>
		<column name="realStart" type="DATE"  description="Project real start"/>
		<column name="realEnd" type="DATE"  description="Project real end"/>
		<column name="cancelled" type="BOOLEAN" description="is project cancelled?" />
		<column name="construction" type="BOOLEAN"  description="is a construction?"/>
		<column name="relevance" type="VARCHAR" size="255" description="Importancia"/>
		<column name="userId" type="INTEGER" description="User Id " />
		<column name="userByAffiliatesId" type="INTEGER" description="UserByAffiliates Id" />
		<column name="updated" type="TIMESTAMP"  description="Updated"/>
		<column name="responsibleCode" type="INTEGER" description="Codigo del responsable"/>

		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="objectives_objective" >
			<reference local="objectiveId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="users_user" >
			<reference local="userId" foreign="id" />
		</foreign-key>

<!--		<foreign-key foreignTable="affiliates_user" >
			<reference local="userByAffiliatesId" foreign="id" />
		</foreign-key> -->

		<foreign-key foreignTable="positions_position" >
			<reference local="responsibleCode" foreign="code" />
		</foreign-key>

	</table>

	<table name="projects_milestoneLog" phpName='ProjectMilestoneLog' description="Milestone Log">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Milestone Id" autoIncrement="true"/>
		<column name="milestoneId" required="true" type="INTEGER" description="Milestone Id" />
		<column name="projectId" required="true" type="INTEGER" description="Project Id"/>
		<column name="name" required="true" type="LONGVARCHAR" description="Milestone Name"/>
		<column name="date" type="DATE"  description="Milestone Creation Date"/>
		<column name="expirationDate" type="DATE"  description="Milestone Expiration Date"/>
		<column name="completed" type="BOOLEAN"  description="is Milestone Completed?"/>
		<column name="notes" type="LONGVARCHAR"  description="Project Notes"/>
		<column name="userId" type="INTEGER" description="User Id " />
		<column name="userByAffiliatesId" type="INTEGER" description="UserByAffiliates Id" />
		<column name="updated" type="TIMESTAMP"  description="Updated"/>
		<column name="lastModification" type="TIMESTAMP"  description="Ultima modificacion Date"/>
		<column name="changes" type="INTEGER" description="Cantidad de modificaciones"/>

		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="projects_milestone" >
			<reference local="milestoneId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="users_user" >
			<reference local="userId" foreign="id" />
		</foreign-key>

<!--		<foreign-key foreignTable="affiliates_user" >
			<reference local="userByAffiliatesId" foreign="id" />
		</foreign-key> -->
	
	</table>	

	<table name="projects_activityLog" phpName='ProjectActivityLog' description="Activity Log">
		<column name="id" required="true" primaryKey="true" type="INTEGER" description="Activity Id" autoIncrement="true"/>
		<column name="activityId" required="true" type="INTEGER" description="Activity Id" />
		<column name="projectId" required="true" type="INTEGER" description="Project Id"/>
		<column name="name" required="true" type="LONGVARCHAR" description="Activity Name"/>
		<column name="description" type="LONGVARCHAR" description="Activity Description"/>
		<column name="date" type="DATE"  description="Activity Creation Date"/>
		<column name="expirationDate" type="DATE"  description="Activity Expiration Date"/>
		<column name="completed" type="BOOLEAN"  description="is Activity Completed?"/>
		<column name="uniqueGoalNumeric" type="INTEGER" description="Project Unique Goal Numeric"/>
		<column name="goalProgress" type="INTEGER" description="Activity Goal Progress"/>
		<column name="notes" type="LONGVARCHAR"  description="Activity Notes"/>
		<column name="userId" type="INTEGER" description="User Id " />
		<column name="userByAffiliatesId" type="INTEGER" description="UserByAffiliates Id" />
		<column name="updated" type="TIMESTAMP"  description="Updated"/>
		<column name="lastModification" type="TIMESTAMP"  description="Ultima modificacion Date"/>
		<column name="changes" type="INTEGER" description="Cantidad de modificaciones"/>
		<column name="plannedStart" type="DATE"  description="Activity planned start"/>
		<column name="plannedEnd" type="DATE"  description="Activity planned End"/>
		<column name="realStart" type="DATE"  description="Activity real start"/>
		<column name="realEnd" type="DATE"  description="Activity real end"/>
		<column name="cancelled" type="BOOLEAN" description="is activity cancelled?" />

		<foreign-key foreignTable="projects_project" >
			<reference local="projectId" foreign="id" />
		</foreign-key>
	
		<foreign-key foreignTable="projects_activity" >
			<reference local="activityId" foreign="id" />
		</foreign-key>

		<foreign-key foreignTable="users_user" >
			<reference local="userId" foreign="id" />
		</foreign-key>

<!--		<foreign-key foreignTable="affiliates_user" >
			<reference local="userByAffiliatesId" foreign="id" />
		</foreign-key> -->

	</table>	


</database>
